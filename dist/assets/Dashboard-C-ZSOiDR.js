import{e as $e,f as ie,p as se,a as ge,c as a,t as m,v as ke,i as r,k as w,m as F,b as f,d as u,s as z,F as ve,n as pe,I as Ie}from"./index-DEGSL-2v.js";import{t as Le,u as we,v as me,w as Pe,x as De,y as Re,z as Te,A as Me,B as Ae,C as Be}from"./fetching-DWZPZ03v.js";import{I as Ue}from"./ImportLoading-_Wdyktms.js";import{L as Ee}from"./Loading-DyQQoSrW.js";import Fe from"./NotFound-BIA5YLEP.js";import{f as he,S as K}from"./SlideUp-BIPXj_AL.js";import{a as ze}from"./svgIcons-CWi8yQy6.js";const Oe="_restore_1nbt8_6",Ne="_backup_1nbt8_7",Xe="_processButtons_1nbt8_8",Ge="_maintainSys_1nbt8_19",He="_reindex_1nbt8_45",Ve="_userContainer_1nbt8_56",Ze="_userCard_1nbt8_66",je="_userInfo_1nbt8_85",We="_userStatus_1nbt8_109",qe="_toggleStatus_1nbt8_122",Je="_reindexForm_1nbt8_162",S={restore:Oe,backup:Ne,processButtons:Xe,maintainSys:Ge,reindex:He,userContainer:Ve,userCard:Ze,userInfo:je,userStatus:We,toggleStatus:qe,reindexForm:Je},Ke="_mainPopoverLog_2ir0l_1",Qe="_headerLog_2ir0l_20",Ye="_logContainer_2ir0l_37",et="_logInfo_2ir0l_53",A={mainPopoverLog:Ke,headerLog:Qe,logContainer:Ye,logInfo:et};var _e=m("<div>"),be=m("<input type=checkbox>"),tt=m("<div><label><h3></h3><p></p></label><div><p></p><button>Stack trade..."),rt=m("<div><label><h3></h3><p>IP: </p><p>Last Login: </p></label><div><p></p><button>User agent..."),nt=m("<h3>Logs Manager"),st=m("<button popovertarget=show-logs-content>show"),it=m("<div><h3>System Logs</h3><button>"),at=m("<div><h3>User Logs</h3><button>"),lt=m("<div popover=auto id=show-logs-content><h1>Logs Management</h1><button>");const ot=()=>{const[l,{refetch:Q}]=$e(we),[h,R]=ie({sysIds:[],uIds:[]}),[B,_]=se(!1),[k,G]=se(!1),H=ge(()=>l()?.system||[]),V=ge(()=>l()?.user||[]),Z=async t=>{const e=t==="system"?h.sysIds:h.uIds;if(e.length===0)return;if(!(await Le(e,t)).ok)return alert(`Delete ${t} logs failed.`);t==="system"?R("sysIds",[]):R("uIds",[]),Q()},j=t=>{t==="system"?(B()&&h.sysIds.length>0&&Z("system"),_(e=>!e)):(k()&&h.uIds.length>0&&Z("user"),G(e=>!e))},Y=(t,e)=>{t?R("sysIds",n=>[...n,e]):R("sysIds",n=>n.filter(i=>i!==e))},W=(t,e)=>{t?R("uIds",n=>[...n,e]):R("uIds",n=>n.filter(i=>i!==e))},ee=()=>(()=>{var t=_e();return r(t,a(ve,{get each(){return H()},children:e=>(()=>{var n=tt(),i=n.firstChild,x=i.firstChild,c=x.nextSibling,g=i.nextSibling,y=g.firstChild,b=y.nextSibling;return r(n,a(w,{get when(){return B()},get children(){var $=be();return $.$$input=v=>Y(v.target.checked,e.error_log_id),f(()=>z($,"id",`system-log-${e.error_log_id}`)),$}}),i),r(x,()=>e.file_error),r(c,()=>e.func_occur),r(y,()=>he(new Date(e.mark_at))),b.$$click=()=>alert(e.stack_trace),b.style.setProperty("font-size","12px"),f($=>{var v=A.logInfo,C=`system-log-${e.error_log_id}`;return v!==$.e&&u(n,$.e=v),C!==$.t&&z(i,"for",$.t=C),$},{e:void 0,t:void 0}),n})()})),f(()=>u(t,A.logContainer)),t})(),te=()=>(()=>{var t=_e();return r(t,a(ve,{get each(){return V()},children:e=>(()=>{var n=rt(),i=n.firstChild,x=i.firstChild,c=x.nextSibling;c.firstChild;var g=c.nextSibling;g.firstChild;var y=i.nextSibling,b=y.firstChild,$=b.nextSibling;return r(n,a(w,{get when(){return k()},get children(){var v=be();return v.$$input=C=>W(C.target.checked,e.user_log_id),f(()=>z(v,"id",`user-log-${e.user_log_id}`)),v}}),i),r(x,()=>e.RegterUser),r(c,()=>e.ip_address,null),r(g,()=>new Date(e.last_logged_in).toLocaleString(),null),r(b,()=>he(new Date(e.logged_at))),$.$$click=()=>alert(e.user_agent),$.style.setProperty("font-size","12px"),f(v=>{var C=A.logInfo,T=`user-log-${e.user_log_id}`;return C!==v.e&&u(n,v.e=C),T!==v.t&&z(i,"for",v.t=T),v},{e:void 0,t:void 0}),n})()})),f(()=>u(t,A.logContainer)),t})(),[o,I]=se(!1);return[(()=>{var t=nt();return t.style.setProperty("margin-top","50px"),t})(),(()=>{var t=st();return t.$$click=()=>I(e=>!e),t})(),a(w,{get when(){return o()},get children(){var t=lt(),e=t.firstChild,n=e.nextSibling;return ke(i=>i,t),r(t,a(w,{get when(){return H().length>0},get children(){return[(()=>{var i=it(),x=i.firstChild,c=x.nextSibling;return c.$$click=()=>j("system"),r(c,()=>B()?h.sysIds.length>0?"Delete":"Cancel":"Select"),f(g=>{var y=A.headerLog,b=`${h.sysIds.length>0?"var(--button-delete-color)":"var(--button-active-color)"}`;return y!==g.e&&u(i,g.e=y),b!==g.t&&((g.t=b)!=null?c.style.setProperty("color",b):c.style.removeProperty("color")),g},{e:void 0,t:void 0}),i})(),F(()=>ee())]}}),n),r(t,a(w,{get when(){return V().length>0},get children(){return[(()=>{var i=at(),x=i.firstChild,c=x.nextSibling;return c.$$click=()=>j("user"),r(c,()=>k()?h.uIds.length>0?"Delete":"Cancel":"Select"),f(g=>{var y=A.headerLog,b=`${h.uIds.length>0?"var(--button-delete-color)":"var(--button-active-color)"}`;return y!==g.e&&u(i,g.e=y),b!==g.t&&((g.t=b)!=null?c.style.setProperty("color",b):c.style.removeProperty("color")),g},{e:void 0,t:void 0}),i})(),F(()=>te())]}}),n),n.$$click=()=>I(!1),n.style.setProperty("position","absolute"),n.style.setProperty("bottom","0"),n.style.setProperty("right","0"),n.style.setProperty("margin","40px"),r(n,ze),f(()=>u(t,A.mainPopoverLog)),t}})]};pe(["input","click"]);var dt=m("<div><label for=importPath>External Drive:</label><input class=inputSearch type=text id=importPath autocomplete=off placeholder=/Volumes/External/Photos>"),ut=m("<div><div>Last restored: </div><button popovertarget=restore-database>Restore"),ct=m("<div><div><div>Thumnail</div><div></div></div><div><div>Hashcode</div><div></div></div><div><div>Caption</div><div></div></div><button>Reindex"),gt=m("<h3>Users Active Status"),vt=m("<div>"),mt=m("<main class=mainHomePage><h3>Import Medias From <!> </h3><div><fieldset><legend></legend><div><input type=checkbox id=detectModel><label for=detectModel>Computer Vision for Search Engine (<!>)</label></div><button>Start Progress</button></fieldset></div><h3>Server Recovery</h3><div><div><div>Last backup: </div><button popovertarget=backup-database>Backup</button></div><div><div>Storage Optimize</div><button popovertarget=optimal-storage>Optimize</button></div><div><div>Scan for Missing Thumbnails</div><button popovertarget=generate-thumbs>Scan"),ht=m("<div><img src=/src/assets/svgs/avatar.svg><div><h3></h3><p></p><a href=#>User Logs</a></div><div><p> </p><div><input type=checkbox><label>");const xt=()=>{const[l,{mutate:Q,refetch:h}]=$e(Be),R=async o=>{if(!(await Ae(o.user_email)).ok)return alert("Failed to update user status!");Q(t=>{if(!t?.users)return t;const e=t.users.findIndex(i=>i.user_email===o.user_email);if(e===-1)return t;const n=[...t.users];return n[e]={...n[e],status:!n[e].status},{...t,users:n}})},[B,_]=ie({mesg:"",isRunning:!1}),[k,G]=ie({path:"",aimode:0}),H=async()=>{_({mesg:"Start processing internal media",isRunning:!0}),await me(_,k,"internal"),h()},V=async()=>{if(!k.path)return alert("Do not accept empty path");_({mesg:`Start processing medias in ${k.path}`,isRunning:!0}),await me(_,k,"external")},Z=async()=>{_({mesg:"Start backing up PhotoX System to external drive",isRunning:!0}),await Pe(_),h()},j=async()=>{const o=await De();alert(o.message),h()},Y=async()=>{_({mesg:"Start optimizing videos in local server",isRunning:!0}),await Re(_),h()},W=()=>{const o=l();return!o||!o.missedData?!1:!Object.values(o.missedData).every(e=>e==0)},ee=async()=>{W()&&(_({mesg:"Start reindexing medias",isRunning:!0}),await Me(_),h())},te=async()=>{_({mesg:"Start scanning for missing thumbnails",isRunning:!0}),await Te(_),h()};return(()=>{var o=mt(),I=o.firstChild,t=I.firstChild,e=t.nextSibling;e.nextSibling;var n=I.nextSibling,i=n.firstChild,x=i.firstChild,c=x.nextSibling,g=c.firstChild,y=g.nextSibling,b=y.firstChild,$=b.nextSibling;$.nextSibling;var v=c.nextSibling,C=n.nextSibling,T=C.nextSibling,q=T.firstChild,re=q.firstChild;re.firstChild,re.nextSibling;var O=q.nextSibling,fe=O.firstChild,Se=fe.nextSibling,ne=O.nextSibling,ye=ne.firstChild,xe=ye.nextSibling;return o.style.setProperty("overflow-y","scroll"),r(o,(()=>{var s=F(()=>!!l.loading);return()=>s()&&a(Ee,{})})(),I),r(o,(()=>{var s=F(()=>!!l.error);return()=>s()&&a(Fe,{})})(),I),r(I,()=>l()?.sysStatus?"External Drive":"Internal Directory",e),r(x,()=>l()?.sysStatus?"Select preferred path for medias":"Start importing media to server"),r(i,a(w,{get when(){return l()?.sysStatus},get children(){var s=dt(),d=s.firstChild,L=d.nextSibling;return L.$$input=P=>G("path",P.target.value),s}}),c),g.addEventListener("change",()=>G("aimode",k.aimode===0?1:0)),r(y,()=>k.aimode?"Enabled":"Disabled",$),v.$$click=()=>l()?.sysStatus?V():H(),r(o,a(w,{get when(){return B.mesg},get children(){return a(Ue,{streamMesg:B,setStreamMesg:_})}}),C),C.style.setProperty("margin-top","50px"),r(re,()=>l()?.lastBackup||"N/A",null),r(q,a(K,{idElement:"backup-database",noticeText:"WARNING! All existing data on your external drive will be deleted and replace with current data in PhotoX system. This action can not be undone.",confirmBtn:Z,infoText:()=>"Backup PhotoX"}),null),r(T,a(w,{get when(){return l()?.lastBackup},get children(){var s=ut(),d=s.firstChild;return d.firstChild,d.nextSibling,r(d,()=>l()?.lastRestore||"N/A",null),r(s,a(K,{idElement:"restore-database",noticeText:"All existing database will be replace with the new data. This action can not be undone.",confirmBtn:j,infoText:()=>"Restore Database"}),null),f(()=>u(s,S.restore)),s}}),O),Se.style.setProperty("background","purple"),r(O,a(K,{idElement:"optimal-storage",noticeText:"Start reducing frames per second for slow motion videos. This action can not be undone.",confirmBtn:Y,infoText:()=>"Optimize Storage"}),null),xe.style.setProperty("background","rgb(242, 88, 253)"),r(ne,a(K,{idElement:"generate-thumbs",noticeText:"Start scanning the whole files system for missing thumbs. This process could talk 5-10mins",confirmBtn:te,infoText:()=>"Regenerate Thumbs"}),null),r(T,a(w,{get when(){return W()},get children(){var s=ct(),d=s.firstChild,L=d.firstChild,P=L.nextSibling,D=d.nextSibling,M=D.firstChild,U=M.nextSibling,N=D.nextSibling,X=N.firstChild,J=X.nextSibling,E=N.nextSibling;return r(P,()=>l()?.missedData.thumbnail),r(U,()=>l()?.missedData.hashcode),r(J,()=>l()?.missedData.caption),E.$$click=ee,f(()=>u(s,`${S.backup} ${S.reindex}`)),s}}),null),r(o,a(w,{get when(){return F(()=>!!(l()&&l()?.users))()&&l()?.users?.length>0},get children(){return[(()=>{var s=gt();return s.style.setProperty("margin-top","50px"),s})(),(()=>{var s=vt();return r(s,a(Ie,{get each(){return l()?.users},children:d=>(()=>{var L=ht(),P=L.firstChild,D=P.nextSibling,M=D.firstChild,U=M.nextSibling,N=D.nextSibling,X=N.firstChild;X.firstChild;var J=X.nextSibling,E=J.firstChild,Ce=E.nextSibling;return P.style.setProperty("background-position","center"),r(M,(()=>{var p=F(()=>!!d().user_name);return()=>p()?d().user_name:""})()),r(U,()=>d().user_email),r(X,()=>d().status?"Active":"Suspended",null),E.$$input=()=>R(d()),f(p=>{var ae=S.userCard,le=S.userInfo,oe=S.userStatus,de=S.toggleStatus,ue=`toggle-${d().reg_user_id}`,ce=`toggle-${d().reg_user_id}`;return ae!==p.e&&u(L,p.e=ae),le!==p.t&&u(D,p.t=le),oe!==p.a&&u(N,p.a=oe),de!==p.o&&u(J,p.o=de),ue!==p.i&&z(E,"id",p.i=ue),ce!==p.n&&z(Ce,"for",p.n=ce),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),f(()=>E.checked=d().status),L})()})),f(()=>u(s,S.userContainer)),s})()]}}),null),r(o,a(ot,{}),null),f(s=>{var d=S.reindexForm,L=S.processButtons,P=S.maintainSys,D=S.backup,M=S.backup,U=S.backup;return d!==s.e&&u(n,s.e=d),L!==s.t&&u(v,s.t=L),P!==s.a&&u(T,s.a=P),D!==s.o&&u(q,s.o=D),M!==s.i&&u(O,s.i=M),U!==s.n&&u(ne,s.n=U),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()};pe(["input","click"]);export{xt as default};
