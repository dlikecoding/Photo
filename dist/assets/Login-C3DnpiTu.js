import{f as N,p as L,t as I,i as h,c as E,A as k,b as O,d as o,n as R}from"./index-DEGSL-2v.js";import{s as l}from"./Guard.module-D_TDubKB.js";import{W as j}from"./toAuthenticatorAttachment-BAxCDoik.js";import{s as q}from"./startAuthentication-mwDUkj2u.js";import{D as B}from"./fetching-DWZPZ03v.js";var D=I('<div><i></i><i></i><i></i><div><h2>Login</h2><p></p><div><input type=email name=email placeholder=Email autocomplete=off autofocus required></div><div><input type=button value="Sign In"></div><div>');const T=()=>{const[f,t]=N({status:!1,msg:""}),[P,_]=L(),C=async()=>{t("status",!0);const i=await fetch(`api/v1/auth/init-auth?email=${P()}`,{credentials:"same-origin"}),s=await i.json();if(!i.ok)return t({status:!1,msg:s.error});let r;try{r=await q({optionsJSON:s})}catch(c){return c instanceof j&&c.name==="NotAllowedError"?t({status:!1,msg:"Authenticator does not allowed."}):t({status:!1,msg:"Authenticator was missing biometric verification."})}const a=await B("api/v1/auth/verify-auth","POST",r),n=await a.json();if(!a.ok)return t({status:!1,msg:n.error});if(!n.verified)return t({status:!1,msg:"Failed to Sign In"});window.location.replace("/library/")};return(()=>{var i=D(),s=i.firstChild,r=s.nextSibling,a=r.nextSibling,n=a.nextSibling,c=n.firstChild,u=c.nextSibling,d=u.nextSibling,p=d.firstChild,m=d.nextSibling,y=m.firstChild,v=m.nextSibling;return s.style.setProperty("--clr","#0051ff"),r.style.setProperty("--clr","#fb00ff"),a.style.setProperty("--clr","#41de2f"),h(u,()=>f.msg),p.addEventListener("focus",()=>t("msg","")),p.$$input=e=>{_(e.target.value)},y.$$click=C,h(v,E(k,{href:"#",children:"Lost key"}),null),h(v,E(k,{href:"/signup",children:"Need an account?"}),null),O(e=>{var b=l.ring,S=l.login,g=f.status?"green":"red",$=l.inputBx,w=l.inputBx,x=f.status,A=l.links;return b!==e.e&&o(i,e.e=b),S!==e.t&&o(n,e.t=S),g!==e.a&&((e.a=g)!=null?u.style.setProperty("color",g):u.style.removeProperty("color")),$!==e.o&&o(d,e.o=$),w!==e.i&&o(m,e.i=w),x!==e.n&&(y.disabled=e.n=x),A!==e.s&&o(v,e.s=A),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),i})()};R(["input","click"]);export{T as default};
